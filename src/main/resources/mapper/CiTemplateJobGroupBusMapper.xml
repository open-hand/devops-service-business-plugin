<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="io.choerodon.devops.infra.mapper.CiTemplateJobGroupBusMapper">


    <select id="queryTemplateJobGroupByParams" resultType="io.choerodon.devops.infra.dto.CiTemplateJobGroupDTO">
        SELECT
          *
        FROM
           devops_ci_template_job_group dctjg
        <where>
            <if test="searchParam != null and searchParam != ''">
                AND dctjg.name LIKE CONCAT(CONCAT('%', #{searchParam, jdbcType=VARCHAR}), '%')
            </if>
        </where>

    </select>


    <select id="checkTemplateJobGroupName" resultType="java.lang.Boolean">
        SELECT count(*) = 0
        FROM devops_ci_template_job_group dctjg
        WHERE dctjg.name = #{name}
        AND dctjg.source_id = #{sourceId}
        <if test="templateJobId != null">
            AND dctjg.id != #{templateJobId}
        </if>
    </select>

</mapper>